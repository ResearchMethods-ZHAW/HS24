{
  "hash": "51aa2380c38121fcbcf2b8ee3f291c22",
  "result": {
    "markdown": "---\ndate: 2023-11-13\nlesson: Stat5\nthema: Von linearen Modellen zu GLMMs\nindex: 3\nformat:\n  html:\n    code-tools:\n      source: true\nknitr:\n    opts_chunk:\n        collapse: false\n---\n\n\n# Stat5: Lösung 1\n\n- Download dieses Lösungsscript via \"\\</\\>Code\" (oben rechts)\n- [Lösungstext als Download](Statistik_Loesung_5.1.pdf)\n\n## Musterlösung Aufgabe 5.1: Split-plot ANOVA\n\n### Übungsaufgabe \n\n**(hier so ausführlich formuliert, wie dies auch in der Klausur der Fall sein wird)**\n\n- Ladet den Datensatz splityield.csv. Dieser enthält Versuchsergebnisse eines\n  Experiments zum Ernteertrag (yield) einer Kulturpflanze in Abhängigkeit der drei\n  Faktoren Bewässerung (irrigated vs. control), Düngung (N, NP, P) und Aussaatdichten\n  (low, medium, high). Es gab vier ganze Felder (block), die zwei Hälften mit den beiden\n  Bewässerungstreatments (irrigation), diese wiederum drei Drittel für die drei\n  Saatdichten (density) und diese schliesslich je drei Drittel für die drei\n  Düngertreatments (fertilizer) hatten.\n- **Ermittelt das minimal adäquate statistische Modell, das den Ernteertrag in\n  Abhängigkeit von den angegebenen Faktoren beschreibt.**\n- Bitte erklärt und begründet die einzelnen Schritte, die ihr unternehmt, um zu diesem\n  Ergebnis zu kommen. Dazu erstellt bitte ein Word-Dokument, in das ihr Schritt für\n  Schritt den verwendeten R-Code, die dazu gehörigen Ausgaben von R, eure\n  Interpretation derselben und die sich ergebenden Schlussfolgerungen für das weitere\n  Vorgehen dokumentieren.\n- Dieser Ablauf sollte insbesondere beinhalten:\n    - Überprüfen der Datenstruktur nach dem Einlesen, welches sind die abhängige(n)\n      und welches die unabängige(n) Variablen\n    - Explorative Datenanalyse, um zu sehen, ob evtl. Dateneingabefehler vorliegen oder\n      Datentransformationen vorgenommen werden sollten\n    - Auswahl und Begründung eines statistischen Verfahrens\n    - Bestimmung des vollständigen/maximalen Models\n    - Selektion des/der besten Models/Modelle\n    - Generieren aller Zahlen, Statistiken und Tabellen, die für eine wiss. _Ergebnisdarstellung benötigt werden_\n    - Formuliert abschliessend einen Methoden- und Ergebnisteil (ggf. incl. adäquaten\n      Abbildungen) zu dieser Untersuchung in der Form einer wissenschaftlichen Arbeit\n      (ausformulierte schriftliche Zusammenfassung, mit je einem Absatz von ca. 60-100\n      Worten, resp. 3-8 Sätzen für den Methoden- und Ergebnisteil). D. h. alle wichtigen\n      Informationen sollten enthalten sein, unnötige Redundanz dagegen vermieden werden.\n    - **Zu erstellen sind (a) Ein lauffähiges R-Skript; (b) begründeter Lösungsweg\n      (Kombination aus R-Code, R Output und dessen Interpretation) und (c) ausformulierter\n      Methoden- und Ergebnisteil (für eine wiss. Arbeit).**\n \n### Kommentierter Lösungsweg\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"readr\")\n\nsplityield <- read_delim(\"datasets/stat5-8/splityield.csv\", \",\", col_types = cols(\"block\" = \"f\", \"irrigation\" = \"f\", \"density\" = \"f\", \"fertilizer\" = \"f\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Checken der eingelesenen Daten\nsplityield\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 72 × 6\n    ...1 yield block irrigation density fertilizer\n   <dbl> <dbl> <fct> <fct>      <fct>   <fct>     \n 1     1    90 A     control    low     N         \n 2     2    95 A     control    low     P         \n 3     3   107 A     control    low     NP        \n 4     4    92 A     control    medium  N         \n 5     5    89 A     control    medium  P         \n 6     6    92 A     control    medium  NP        \n 7     7    81 A     control    high    N         \n 8     8    92 A     control    high    P         \n 9     9    93 A     control    high    NP        \n10    10    80 A     irrigated  low     N         \n# ℹ 62 more rows\n```\n:::\n:::\n\nMan sieht, dass das Design vollkommen balanciert ist, d.h. jede Kombination irrigation *\ndensity * fertilizer kommt genau 4x vor (in jedem der vier Blöcke A-D einmal).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(splityield)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nspc_tbl_ [72 × 6] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ ...1      : num [1:72] 1 2 3 4 5 6 7 8 9 10 ...\n $ yield     : num [1:72] 90 95 107 92 89 92 81 92 93 80 ...\n $ block     : Factor w/ 4 levels \"A\",\"B\",\"C\",\"D\": 1 1 1 1 1 1 1 1 1 1 ...\n $ irrigation: Factor w/ 2 levels \"control\",\"irrigated\": 1 1 1 1 1 1 1 1 1 2 ...\n $ density   : Factor w/ 3 levels \"low\",\"medium\",..: 1 1 1 2 2 2 3 3 3 1 ...\n $ fertilizer: Factor w/ 3 levels \"N\",\"P\",\"NP\": 1 2 3 1 2 3 1 2 3 1 ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   ...1 = col_double(),\n  ..   yield = col_double(),\n  ..   block = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE),\n  ..   irrigation = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE),\n  ..   density = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE),\n  ..   fertilizer = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE)\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n:::\n\n```{.r .cell-code}\nsummary(splityield)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      ...1           yield        block      irrigation   density   fertilizer\n Min.   : 1.00   Min.   : 60.00   A:18   control  :36   low   :24   N :24     \n 1st Qu.:18.75   1st Qu.: 86.00   B:18   irrigated:36   medium:24   P :24     \n Median :36.50   Median : 95.00   C:18                  high  :24   NP:24     \n Mean   :36.50   Mean   : 99.72   D:18                                        \n 3rd Qu.:54.25   3rd Qu.:114.00                                               \n Max.   :72.00   Max.   :136.00                                               \n```\n:::\n\n```{.r .cell-code}\nsplityield$density <- ordered(splityield$density, levels = c(\"low\", \"medium\", \"high\"))\nsplityield$density\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] low    low    low    medium medium medium high   high   high   low   \n[11] low    low    medium medium medium high   high   high   low    low   \n[21] low    medium medium medium high   high   high   low    low    low   \n[31] medium medium medium high   high   high   low    low    low    medium\n[41] medium medium high   high   high   low    low    low    medium medium\n[51] medium high   high   high   low    low    low    medium medium medium\n[61] high   high   high   low    low    low    medium medium medium high  \n[71] high   high  \nLevels: low < medium < high\n```\n:::\n:::\n\nMan sieht, dass die Variable yield metrisch ist, während die vier anderen Variablen schon\nkorrekt als kategoriale Variablen (factors) kodiert sind\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Explorative Datenanalyse (auf Normalverteilung, Varianzhomogenität)\nboxplot(yield~fertilizer, data = splityield)\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(yield~irrigation, data = splityield)\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(yield~density, data = splityield)\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(yield~irrigation * density * fertilizer, data = splityield)\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-4-4.png){width=672}\n:::\n:::\n\nDie Boxplots sind generell hinreichend symmetrisch, so dass man davon ausgehen kann, dass\nkeine problematische Abweichung von der Normalverteilung vorliegt. Die Varianzhomogenität\nsieht für den Gesamtboxplot sowie für fertilizer und density bestens aus, für irrigation und für\ndie 3-fach-Interaktion deuten sich aber gewisse Varianzheterogenitäten an, d. h. die Boxen\n(Interquartil-Spannen) sind deutlich unterschiedlich lang. Da das Design aber vollkommen\n„balanciert“ war, wie wir von oben wissen, sind selbst relativ stark divergierende Varianzen\nnicht besonders problematisch. Der Boxplot der Dreifachinteraktion zeigt zudem, dass\ngrössere Varianzen (~Boxen) mal bei kleinen, mal bei grossen Mittelwerten vorkommen,\nwomit wir bedenkenlos weitermachen können (Wenn die grossen Varianzen immer bei\ngrossen Mittelwerten aufgetreten wären, hätten wir eine log- oder Wurzeltransformation von\nyield in Betracht ziehen müssen).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(log10(yield) ~ irrigation * density * fertilizer, data = splityield) # bringt keine Verbesserung\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\naov.1 <- aov(yield ~ irrigation * density * fertilizer + Error(block / irrigation / density), data = splityield)\n```\n:::\n\n\nDas schwierigste an der Analyse ist hier die Definition des Splitt-Plot ANOVA-Modells. Hier\nmachen wir es mit der einfachsten Möglichkeit, dem aov-Befehl. Um diesen richtig zu\nspezifieren, muss man verstanden haben, welches der „random“-Faktor war und wie die\n„fixed“ factors ineinander geschachtelt waren. In diesem Fall ist block der random Faktor, in\nden zunächst irrigation und dann density geschachtelt sind (die unterste Ebene fertilizer muss\nman nicht mehr angeben, da diese in der nächsthöheren nicht repliziert ist).\n\n(Übrigens: das simple 3-faktorielle ANOVA-Modell\naov(yield~irrigation*density*fertilizer,data=splityield) würde unterstellen, dass alle 72 subplot\nunabhängig von allen anderen angeordnet sind, also nicht in Blöcken. Man kann ausprobieren,\nwie sich das Ergebnis mit dieser Einstellung unterscheidet)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(aov.1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nError: block\n          Df Sum Sq Mean Sq F value Pr(>F)\nResiduals  3  194.4   64.81               \n\nError: block:irrigation\n           Df Sum Sq Mean Sq F value Pr(>F)  \nirrigation  1   8278    8278   17.59 0.0247 *\nResiduals   3   1412     471                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nError: block:irrigation:density\n                   Df Sum Sq Mean Sq F value Pr(>F)  \ndensity             2   1758   879.2   3.784 0.0532 .\nirrigation:density  2   2747  1373.5   5.912 0.0163 *\nResiduals          12   2788   232.3                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nError: Within\n                              Df Sum Sq Mean Sq F value   Pr(>F)    \nfertilizer                     2 1977.4   988.7  11.449 0.000142 ***\nirrigation:fertilizer          2  953.4   476.7   5.520 0.008108 ** \ndensity:fertilizer             4  304.9    76.2   0.883 0.484053    \nirrigation:density:fertilizer  4  234.7    58.7   0.680 0.610667    \nResiduals                     36 3108.8    86.4                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nWir bekommen p-Werte für die drei Einzeltreatments, die drei 2-fach-Interaktionen und die 3-\nfach Interaktion. Keinen p-Wert gibt es dagegen für block, da dieser als „random“ Faktor\nspezifiziert wurde.\nSignifikant sind für sich genommen irrigation und fertilizer sowie die Interaktionen\nirrigation:density und irrigation:fertilizer.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Modelvereinfachung\naov.2 <- aov(yield ~ irrigation + density + fertilizer + irrigation:density +\n  irrigation:fertilizer + density:fertilizer + Error(block / irrigation / density), data = splityield)\nsummary(aov.2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nError: block\n          Df Sum Sq Mean Sq F value Pr(>F)\nResiduals  3  194.4   64.81               \n\nError: block:irrigation\n           Df Sum Sq Mean Sq F value Pr(>F)  \nirrigation  1   8278    8278   17.59 0.0247 *\nResiduals   3   1412     471                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nError: block:irrigation:density\n                   Df Sum Sq Mean Sq F value Pr(>F)  \ndensity             2   1758   879.2   3.784 0.0532 .\nirrigation:density  2   2747  1373.5   5.912 0.0163 *\nResiduals          12   2788   232.3                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nError: Within\n                      Df Sum Sq Mean Sq F value   Pr(>F)    \nfertilizer             2   1977   988.7  11.828 9.21e-05 ***\nirrigation:fertilizer  2    953   476.7   5.703  0.00662 ** \ndensity:fertilizer     4    305    76.2   0.912  0.46639    \nResiduals             40   3344    83.6                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\naov.3 <- aov(yield ~ irrigation + density + fertilizer + irrigation:density +\n  irrigation:fertilizer + Error(block / irrigation / density), data = splityield)\nsummary(aov.3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nError: block\n          Df Sum Sq Mean Sq F value Pr(>F)\nResiduals  3  194.4   64.81               \n\nError: block:irrigation\n           Df Sum Sq Mean Sq F value Pr(>F)  \nirrigation  1   8278    8278   17.59 0.0247 *\nResiduals   3   1412     471                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nError: block:irrigation:density\n                   Df Sum Sq Mean Sq F value Pr(>F)  \ndensity             2   1758   879.2   3.784 0.0532 .\nirrigation:density  2   2747  1373.5   5.912 0.0163 *\nResiduals          12   2788   232.3                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nError: Within\n                      Df Sum Sq Mean Sq F value   Pr(>F)    \nfertilizer             2   1977   988.7  11.924 7.28e-05 ***\nirrigation:fertilizer  2    953   476.7   5.749  0.00605 ** \nResiduals             44   3648    82.9                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nJetzt muss man nur noch herausfinden, wie irrigation und fertilizer wirken und wie die\nInteraktionen aussehen. Bei multiplen ANOVAs macht man das am besten visuell:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualisierung der Ergebnisse\nboxplot(yield ~ fertilizer, data = splityield)\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(yield ~ irrigation, data = splityield)\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n\n```{.r .cell-code}\ninteraction.plot(splityield$fertilizer, splityield$irrigation, splityield$yield,\n  xlab = \"fertilizer\", ylab = \"mean of splityield\", trace.label = \"irrigation\"\n)\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-8-3.png){width=672}\n:::\n\n```{.r .cell-code}\ninteraction.plot(splityield$density, splityield$irrigation, splityield$yield,\n  xlab = \"fertilizer\", ylab = \"mean of splityield\", trace.label = \"irrigation\"\n)\n```\n\n::: {.cell-output-display}\n![](Statistik5_Loesung_1_files/figure-html/unnamed-chunk-8-4.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Statistik5_Loesung_1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}