{
  "hash": "ec6aaed2848c6f6cea02806583d79be7",
  "result": {
    "markdown": "---\ndate: 2023-11-13\nlesson: Stat5\nthema: Von linearen Modellen zu GLMMs\nindex: 4\nformat:\n  html:\n    code-tools:\n      source: true\nknitr:\n    opts_chunk:\n        collapse: false\n---\n\n\n# Stat5: Lösung 2\n\n- Download dieses Lösungsscript via \"\\</\\>Code\" (oben rechts)\n\n## Musterlösung Übung 5.2: GLMM\n\n- Lese-Empfehlung Kapitel 4.3.1 von [Christopher Molnar](https://christophm.github.io/interpretable-ml-book/extend-lm.html#glm)\n- Für Interessierte [hier](https://rpsychologist.com/r-guide-longitudinal-lme-lmer) oder [hier](https://rpubs.com/kaz_yos/glmm1)\n\n### Kommentierter Lösungsweg\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# lade datei\ndf <- read_delim(\"datasets/stat5-8/Datensatz_novanimal_Uebung_Statistik5.2.csv\", \";\")\n\n# sieht euch die Verteilung zwischen Fleisch und  kein Fleisch an,\n# beide Kategorien kommen nicht gleich häufig vor, ist aber nicht tragisch\nprop.table(table(df$meat)) # gibt die Prozente an\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n        0         1 \n0.3959218 0.6040782 \n```\n:::\n\n```{.r .cell-code}\ntable(df$meat) # gibt die absoluten Werte an\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n    0     1 \n 7087 10813 \n```\n:::\n\n```{.r .cell-code}\n# definiert das logistische Modell mit ccrs als random intercept und\n# wendet es auf den Datensatz an\n\n# Exkurs für Neugierige\n# check out ICC: https://www.datanovia.com/en/lessons/intraclass-correlation-coefficient-in-r/\n# attention: however data needs to be wide format\n\n# dauert ein paar Sekunden\nmod0 <- glmer(meat ~ gender + member + age_group + (1 | ccrs),\n  data = df, binomial(\"logit\")\n)\n\n# lasst euch das Modell anzeigen: sieht so aus, als ob v.a. Geschlecht eine\n# Rolle spielt\n# Wahrnmeldung kann vernachlässigt werden (aufgrund der unicode resp.\n# Umlaute in den Variablen)\nsummary(mod0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeneralized linear mixed model fit by maximum likelihood (Laplace\n  Approximation) [glmerMod]\n Family: binomial  ( logit )\nFormula: meat ~ gender + member + age_group + (1 | ccrs)\n   Data: df\n\n     AIC      BIC   logLik deviance df.resid \n 21124.3  21178.8 -10555.1  21110.3    17893 \n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.8652 -0.7267  0.4335  0.6449  3.4115 \n\nRandom effects:\n Groups Name        Variance Std.Dev.\n ccrs   (Intercept) 1.487    1.219   \nNumber of obs: 17900, groups:  ccrs, 1427\n\nFixed effects:\n                          Estimate Std. Error z value Pr(>|z|)    \n(Intercept)               -0.12569    0.14484  -0.868   0.3855    \ngenderM                    0.94466    0.08386  11.265   <2e-16 ***\nmemberStudierende         -0.17822    0.12655  -1.408   0.1591    \nage_group26 bis 34-jährig -0.16855    0.10175  -1.657   0.0976 .  \nage_group35 bis 49-jährig -0.02040    0.15634  -0.131   0.8962    \nage_group50 bis 64-jährig  0.09752    0.20159   0.484   0.6286    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) gendrM mmbrSt a_26b3 a_35b4\ngenderM     -0.337                            \nmembrStdrnd -0.834 -0.023                     \nag_gr26b34- -0.537 -0.025  0.349              \nag_gr35b49- -0.737  0.043  0.662  0.463       \nag_gr50b64- -0.637  0.018  0.597  0.389  0.515\n```\n:::\n\n```{.r .cell-code}\n## erste Interpretation: Geschlecht (Referenzkategorie: Mann) und Alter (Referenzkategorie: junge Personen) scheinen den Fleischkonsum positiv zu beeinflussen + Hochschulzugehörigkeit spielt keien Rolle\n# d.h. könnte man vernachlässigen. Ich lasse aus inhaltlichen Gründen aber im Modell drin\n\n# Pseudo R^2\nlibrary(\"MuMIn\")\nr.squaredGLMM(mod0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   R2m       R2c\ntheoretical 0.04069363 0.3392838\ndelta       0.03537645 0.2949517\n```\n:::\n\n```{.r .cell-code}\n# das marginale R^2 (r2m) gibt uns die erklärte Varianz der fixen Effekte: hier 4% (das ist sehr wenig)\n# das conditionale R^2 (r2c) gibt uns die erklärte Varianz für das ganze Modell\n# (mit fixen und variablen Effekten): hier 29% (ganz ok, aber auch nicht sehr hoch)\n# für weitere Informationen: https://rdrr.io/cran/MuMIn/man/r.squaredGLMM.html\n\n# zusätzliche Informationen, welche für die Interpretation gut sein kann\n# berechnet den Standardfehler (mehr infos: https://www.youtube.com/watch?v=r-txC-dpI-E oder hier: https://mgimond.github.io/Stats-in-R/CI.html)\n# weitere info: https://stats.stackexchange.com/questions/26650/how-do-i-reference-a-regression-models-coefficients-standard-errors\nse <- sqrt(diag(vcov(mod0)))\n\n# zeigt eine Tabelle der Schätzer mit 95% Konfidenzintervall (KI)\n# => Faustregel: falls 0 im KI enthalten ist, dann ist der Unterschied statistisch NICHT signifikant\ntab1 <- cbind(\n  Est = fixef(mod0), LL = fixef(mod0) - 1.96 * se,\n  UL = fixef(mod0) + 1.96 * se\n)\n\n# erzeugt die Odds Ratios\ntab2 <- exp(tab1)\n```\n:::\n\n\n### Methoden\n\nDie Responsevariable “Fleischkonsum” ist eine binäre Variable. Demnach wird eine multiple logistische Regression mit den Prädiktoren “Alter (Gruppen)”, “Geschlecht” und “Hochschulzugehörigkeit” gerechnet. Da in den Daten gewisse Individuen mehrmals vorkommen, wird das Individuum (Variable ccrs) als variabler Effekt in das Modell aufgenommen.\n\n### Ergebnisse\n\nDas Geschlecht und das Alter nehmen einen signifikanten Einfluss auf den Fleischkonsum (siehe Table 1): Männer kaufen signifikant häufiger ein fleischhaltiges Gericht als Frauen; junge Personen (15 bis 25-jährig) kaufen signifikant häufiger ein fleischhaltiges Gericht in der Mensa. Es sieht so aus, als ob die Hochschulzugehörigkeit auf den ersten Blick keinen Einfluss nimmt. Aber man müsste auch die Interaktion zwischen Geschlecht und Hochschulzugehörigkeit berücksichtigen, um ein abschliessendes Bild zu bekommen. Das kleine marginale Pseudo-R^2 zeigt auf, dass es nicht das \"beste\" Modell ist. Insbesondere die tiefe Varianzaufklärung für die randomisierte Variable (r2c; ccrs) scheint mit (nur) 4% sehr gering. Das sind Hinweise dafür, dass im Modell gegebenenfalls noch weitere Faktoren miteinbezogen werden müssten (z.B. Standort Mensa).\n\n\n::: {.cell}\n::: {.cell-output-display}\nTable: Modellschätzer (Coefficients) mit dazugehörigem 95% Konfidenzintervall\n\n|                 | Coefficients| Lower Limit (LL)| Uppewr Limit (UL)|\n|:----------------|------------:|----------------:|-----------------:|\n|Intercept        |        -0.13|            -0.41|              0.16|\n|Männer           |         0.94|             0.78|              1.11|\n|Mitarbeitende    |        -0.18|            -0.43|              0.07|\n|26 bis 34-jährig |        -0.17|            -0.37|              0.03|\n|35 bis 49-jährig |        -0.02|            -0.33|              0.29|\n|50 bis 64-jährig |         0.10|            -0.30|              0.49|\n:::\n:::\n\n\nDie Chance, dass Männer ein fleischhaltiges Gericht kaufen ist 2.57mal (+157%) höher als bei Frauen (siehe Table 2). Die Chance, dass 26 bis 34-jährige Personen ein fleischhaltiges Gericht kaufen ist kleiner (-16%) als bei den 15 bis 25-jährigen Personen.\n\n\n::: {.cell}\n::: {.cell-output-display}\nTable: Odds Ratio (OR) mit dazugehörigem 95% Konfidenzintervall\n\n|                 |   OR| Lower Limit (LL)| Uppewr Limit (UL)|\n|:----------------|----:|----------------:|-----------------:|\n|Intercept        | 0.88|             0.66|              1.17|\n|Männer           | 2.57|             2.18|              3.03|\n|Mitarbeitende    | 0.84|             0.65|              1.07|\n|26 bis 34-jährig | 0.84|             0.69|              1.03|\n|35 bis 49-jährig | 0.98|             0.72|              1.33|\n|50 bis 64-jährig | 1.10|             0.74|              1.64|\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}