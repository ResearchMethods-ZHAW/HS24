{
  "hash": "bf08522e3c6a343e6114e566342d4565",
  "result": {
    "markdown": "---\nexecute:\n  echo: true   # set to true to show musterlösung\n  output: true # set to true to show musterlösung\ncode-fold: true\ncode-summary: \"Musterlösung\"\nknitr:\n  opts_chunk: \n    collapse: true\n---\n\n\n# BiEc6_N Modellgüte und -diagnostics MM\n\n## Libraries laden\n\nPackages die wir für die Modelle und die Diagnostics brauchen\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(\"lme4\")\nlibrary(\"bbmle\")\nlibrary(\"MuMIn\")\nlibrary(\"dplyr\")\nlibrary(\"readr\")\nlibrary(\"ggplot2\")\nlibrary(\"DHARMa\")\nlibrary(\"car\")\nlibrary(\"MASS\")\nlibrary(\"ROCR\")\nlibrary(\"sjPlot\")\nlibrary(\"ggeffects\")\nlibrary(\"sjstats\")\nlibrary(\"cowplot\")\nlibrary(\"gstat\")\nlibrary(\"purrr\")\nlibrary(\"broom.mixed\")\n```\n:::\n\n\n## Ausgangslage\n\n- Der Modellfit aus Aufgabe 5 von letzter Woche dient als Ausgangspunkt für die heutigen Übungen. \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nDF_mod_day <- read_delim(\"datasets/fallstudie_n/Aufgabe4_Datensatz_Habitatnutzung_Modelle_231027_moodle.csv\", delim = \";\") |>\n  filter(time_of_day == \"day\") |>\n  mutate(\n    slope_scaled = scale(slope),\n    topo_pos_scaled = scale(topo_pos),\n    us_scaled = scale(us_2014),\n    os_scaled = scale(os_2014),\n    forest_prop_scaled = scale(forest_prop),\n    dist_road_all_scaled = scale(dist_road_all),\n    dist_road_only_scaled = scale(dist_road_only),\n    dist_sett_scaled = scale(dist_sett),\n    remoteness_scaled = scale(remoteness),\n    id = as.factor(id)\n  )\n\nf <- pres_abs ~\n  slope_scaled +\n  us_scaled +\n  os_scaled +\n  forest_prop_scaled +\n  dist_road_only_scaled +\n  dist_sett_scaled +\n  remoteness_scaled\n\nf <- paste(c(f, \"+ (1 | id)\"), collapse = \" \") |> as.formula()\n\nm_day <- glmer(f, data = DF_mod_day, family = binomial, na.action = \"na.fail\")\n\nall_m <- dredge(m_day)\n\navgmodel <- model.avg(all_m, rank = \"AICc\", subset = delta < 2)\nsummary(avgmodel)\n## \n## Call:\n## model.avg(object = get.models(object = all_m, subset = delta < \n##     2), rank = \"AICc\")\n## \n## Component model call: \n## glmer(formula = pres_abs ~ <4 unique rhs>, data = DF_mod_day, family = \n##      binomial, na.action = na.fail)\n## \n## Component models: \n##       df   logLik    AICc delta weight\n## 1357   6 -2261.70 4535.41  0.00   0.39\n## 12357  7 -2261.02 4536.07  0.65   0.28\n## 13567  7 -2261.52 4537.06  1.65   0.17\n## 13457  7 -2261.60 4537.23  1.82   0.16\n## \n## Term codes: \n## dist_road_only_scaled      dist_sett_scaled    forest_prop_scaled \n##                     1                     2                     3 \n##             os_scaled     remoteness_scaled          slope_scaled \n##                     4                     5                     6 \n##             us_scaled \n##                     7 \n## \n## Model-averaged coefficients:  \n## (full average) \n##                        Estimate Std. Error Adjusted SE z value Pr(>|z|)    \n## (Intercept)           -0.437730   0.148042    0.148087   2.956  0.00312 ** \n## dist_road_only_scaled  0.510519   0.052598    0.052614   9.703  < 2e-16 ***\n## forest_prop_scaled     0.844263   0.058809    0.058826  14.352  < 2e-16 ***\n## remoteness_scaled     -0.255199   0.056758    0.056775   4.495    7e-06 ***\n## us_scaled              0.382072   0.040946    0.040959   9.328  < 2e-16 ***\n## dist_sett_scaled      -0.020550   0.046737    0.046744   0.440  0.66021    \n## slope_scaled          -0.006037   0.027844    0.027851   0.217  0.82839    \n## os_scaled              0.004232   0.026310    0.026317   0.161  0.87225    \n##  \n## (conditional average) \n##                       Estimate Std. Error Adjusted SE z value Pr(>|z|)    \n## (Intercept)           -0.43773    0.14804     0.14809   2.956  0.00312 ** \n## dist_road_only_scaled  0.51052    0.05260     0.05261   9.703  < 2e-16 ***\n## forest_prop_scaled     0.84426    0.05881     0.05883  14.352  < 2e-16 ***\n## remoteness_scaled     -0.25520    0.05676     0.05678   4.495    7e-06 ***\n## us_scaled              0.38207    0.04095     0.04096   9.328  < 2e-16 ***\n## dist_sett_scaled      -0.07295    0.06270     0.06272   1.163  0.24479    \n## slope_scaled          -0.03532    0.05918     0.05919   0.597  0.55069    \n## os_scaled              0.02690    0.06157     0.06159   0.437  0.66226    \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n\n- Die Modellresultate aus dem avgmodel sind grundätzlich die finalen Resultate die bereits interpretiert werden könnten. Allerdings funktionieren die Diagnosetests und die Darstellung der Resultate mit diesem gemittelten Modell nicht sehr gut, weshalb wir einen re-fit mit glmer machen müssen (an den Resultaten ändert sich dadurch nichts) \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# hier zum Vergleich, dass die Resulate sich nur marginal verändern\n\nsummary(avgmodel)\n## \n## Call:\n## model.avg(object = get.models(object = all_m, subset = delta < \n##     2), rank = \"AICc\")\n## \n## Component model call: \n## glmer(formula = pres_abs ~ <4 unique rhs>, data = DF_mod_day, family = \n##      binomial, na.action = na.fail)\n## \n## Component models: \n##       df   logLik    AICc delta weight\n## 1357   6 -2261.70 4535.41  0.00   0.39\n## 12357  7 -2261.02 4536.07  0.65   0.28\n## 13567  7 -2261.52 4537.06  1.65   0.17\n## 13457  7 -2261.60 4537.23  1.82   0.16\n## \n## Term codes: \n## dist_road_only_scaled      dist_sett_scaled    forest_prop_scaled \n##                     1                     2                     3 \n##             os_scaled     remoteness_scaled          slope_scaled \n##                     4                     5                     6 \n##             us_scaled \n##                     7 \n## \n## Model-averaged coefficients:  \n## (full average) \n##                        Estimate Std. Error Adjusted SE z value Pr(>|z|)    \n## (Intercept)           -0.437730   0.148042    0.148087   2.956  0.00312 ** \n## dist_road_only_scaled  0.510519   0.052598    0.052614   9.703  < 2e-16 ***\n## forest_prop_scaled     0.844263   0.058809    0.058826  14.352  < 2e-16 ***\n## remoteness_scaled     -0.255199   0.056758    0.056775   4.495    7e-06 ***\n## us_scaled              0.382072   0.040946    0.040959   9.328  < 2e-16 ***\n## dist_sett_scaled      -0.020550   0.046737    0.046744   0.440  0.66021    \n## slope_scaled          -0.006037   0.027844    0.027851   0.217  0.82839    \n## os_scaled              0.004232   0.026310    0.026317   0.161  0.87225    \n##  \n## (conditional average) \n##                       Estimate Std. Error Adjusted SE z value Pr(>|z|)    \n## (Intercept)           -0.43773    0.14804     0.14809   2.956  0.00312 ** \n## dist_road_only_scaled  0.51052    0.05260     0.05261   9.703  < 2e-16 ***\n## forest_prop_scaled     0.84426    0.05881     0.05883  14.352  < 2e-16 ***\n## remoteness_scaled     -0.25520    0.05676     0.05678   4.495    7e-06 ***\n## us_scaled              0.38207    0.04095     0.04096   9.328  < 2e-16 ***\n## dist_sett_scaled      -0.07295    0.06270     0.06272   1.163  0.24479    \n## slope_scaled          -0.03532    0.05918     0.05919   0.597  0.55069    \n## os_scaled              0.02690    0.06157     0.06159   0.437  0.66226    \n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nsummary(m_day)\n## Generalized linear mixed model fit by maximum likelihood (Laplace\n##   Approximation) [glmerMod]\n##  Family: binomial  ( logit )\n## Formula: \n## pres_abs ~ slope_scaled + us_scaled + os_scaled + forest_prop_scaled +  \n##     dist_road_only_scaled + dist_sett_scaled + remoteness_scaled +  \n##     (1 | id)\n##    Data: DF_mod_day\n## \n##      AIC      BIC   logLik deviance df.resid \n##   4539.3   4595.9  -2260.7   4521.3     3955 \n## \n## Scaled residuals: \n##     Min      1Q  Median      3Q     Max \n## -6.1673 -0.7219 -0.3612  0.8565  4.0178 \n## \n## Random effects:\n##  Groups Name        Variance Std.Dev.\n##  id     (Intercept) 0.2387   0.4886  \n## Number of obs: 3964, groups:  id, 12\n## \n## Fixed effects:\n##                       Estimate Std. Error z value Pr(>|z|)    \n## (Intercept)           -0.44517    0.14715  -3.025 0.002484 ** \n## slope_scaled          -0.04861    0.06215  -0.782 0.434154    \n## us_scaled              0.37862    0.04293   8.820  < 2e-16 ***\n## os_scaled              0.03339    0.06512   0.513 0.608141    \n## forest_prop_scaled     0.85465    0.07448  11.474  < 2e-16 ***\n## dist_road_only_scaled  0.51282    0.05294   9.687  < 2e-16 ***\n## dist_sett_scaled      -0.07131    0.06324  -1.127 0.259536    \n## remoteness_scaled     -0.23229    0.06529  -3.558 0.000374 ***\n## ---\n## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n## \n## Correlation of Fixed Effects:\n##             (Intr) slp_sc us_scl os_scl frst__ dst___ dst_s_\n## slope_scald  0.019                                          \n## us_scaled    0.005 -0.093                                   \n## os_scaled    0.004 -0.301 -0.288                            \n## frst_prp_sc -0.077  0.037  0.057 -0.594                     \n## dst_rd_nly_ -0.018  0.089  0.016  0.006  0.187              \n## dst_stt_scl  0.051  0.014  0.023  0.117 -0.466 -0.113       \n## rmtnss_scld  0.018 -0.551 -0.006  0.078 -0.201 -0.481 -0.010\n```\n:::\n\n\n## Aufgabe 1\n\nBerechung der AUC (area under the receiver operating characteristic curve) **= Mass der Modellgüte**\n\nFür die Berechnung des AUC findet ihr weiterführende Informationen unter: [Link](simtest.pdf) \n\n\n::: {.cell}\n\n```{.r .cell-code}\nprob <- predict(m_day, type = c(\"response\"))\npred <- prediction(prob, DF_mod_day$pres_abs)\n\n?prediction\n\n# AUC\n\nauc <- performance(pred, measure = \"auc\")@y.values[[1]]\nauc\n```\n:::\n\n\n## Aufgabe 2\n\nInterpretieren der Modell-Residuen mittels Tests auf verschiedene Aspekte\n\n- Model testing for over/underdispersion, zeroinflation and spatial autocorrelation following the DHARMa package.\n- unbedingt die Vignette des DHARMa-Package konsultieren: [Link](https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Residuals werden über eine Simulation auf eine Standard-Skala transformiert und\n# können anschliessend getestet werden. Dabei kann die Anzahl Simulationen eingestellt\n# werden (dauert je nach dem sehr lange)\n\nsimulationOutput <- simulateResiduals(fittedModel = m_day, n = 10000)\n\n# plotting and testing scaled residuals\n\nplot(simulationOutput)\ntestResiduals(simulationOutput)\n\n# The most common concern for GLMMs is overdispersion, underdispersion and\n# zero-inflation.\n\n# separate test for dispersion\n\ntestDispersion(simulationOutput)\n\n# test for Zeroinflation\n\ntestZeroInflation(simulationOutput)\n\n# test for spatial Autocorrelation\n\n# calculating x, y positions per group\ngroupLocations <- aggregate(DF_mod_day[, 3:4], list(DF_mod_day$x, DF_mod_day$y), mean)\ngroupLocations$group <- paste(groupLocations$Group.1, groupLocations$Group.2)\ngroupLocations <- groupLocations |> dplyr::select(x,y,group)\n\n\n\n# calculating residuals per group\nres2 = recalculateResiduals(simulationOutput, group = groupLocations$group)\n\n# running the spatial test on grouped residuals\ntestSpatialAutocorrelation(res2, groupLocations$x, groupLocations$y, plot = F)\n\n# Testen auf Multicollinearität (dh zu starke Korrelationen im finalen Modell, zB falls\n# auf Grund der ökologischen Plausibilität stark korrelierte Variablen im Modell)\n# use VIF values: if values less then 5 is ok (sometimes > 10), if mean of VIF values\n# not substantially greater than 1 (say 5), no need to worry.\n\ncar::vif(m_day)\nmean(car::vif(m_day))\n```\n:::\n\n\n## Aufgabe 3\n\nGraphische Darstellung der Modellresultate\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# graphische Darstellung der gesamten Modellresultate\n\nplot_model(m_day, transform = NULL, show.values = TRUE, value.offset = .3)\n\n# Plotten der vorhergesagten Wahrscheinlichkeit, dass ein Kreis besetzt ist, in\n# Abhängigkeit der erklärenden Variable basierend auf den Modellresultaten.\n\nplot_model(m_day, type = \"pred\", terms = \"us_scaled [all]\")\n\n# Problem: skalierte Variablen lassen sich nicht so ohne weiteres plotten, hier ein quick-\n# and-dirty hack um das Problem zu umgehen. Die Einstellungen müssen für jede Variable\n# geändert werden\n\np <- plot_model(m_day, type = \"pred\", terms = \"us_scaled [all]\")\n\nlabels <- round(seq(floor(min(DF_mod_day$us_2014)), ceiling(max(DF_mod_day$us_2014)), length.out = 8), 2)\n\np <- p + scale_x_continuous(breaks = c(-1, 0, 1, 2, 3, 4, 5, 6), labels = c(labels))\n\np\n\n# Funktion um viele Plots auf einem zusammenbringen: cowplot-package (hat auch sonst\n# gute Funktionen für schöne Layouts für Grafiken)\n\ncowplot::plot_grid()\n```\n:::\n\n\n## Aufgabe 4\n\nErmittlung des individuellen Beitrags der einzelen Variablen im Gesamtmodell\n\n- Bestimmen delta AIC nach @coppes2017 → Vergleich des Gesamtmodells gegenüber einem Modell ohne die entsprechende Variable.\n- Auftrag auf nächste Woche: Kurze Vorstellung der Modellresultate & Diagnostics im Plenum und Diskussion der Ergebnisse (keine PP-Präsentation nötig)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm_os <- glmer(pres_abs ~\n  slope_scaled +\n  us_scaled +\n  forest_prop_scaled +\n  dist_road_only_scaled +\n  dist_sett_scaled +\n  remoteness_scaled +\n  (1 | id), data = DF_mod_day, family = binomial, na.action = \"na.fail\")\n\nm_us <- glmer(pres_abs ~\n  slope_scaled +\n  forest_prop_scaled +\n  dist_road_only_scaled +\n  dist_sett_scaled +\n  remoteness_scaled +\n  os_scaled +\n  (1 | id), data = DF_mod_day, family = binomial, na.action = \"na.fail\")\n\nm_road <- glmer(pres_abs ~\n  slope_scaled +\n  forest_prop_scaled +\n  dist_sett_scaled +\n  remoteness_scaled +\n  us_scaled +\n  os_scaled +\n  (1 | id), data = DF_mod_day, family = binomial, na.action = \"na.fail\")\n\nm_forest <- glmer(pres_abs ~\n  dist_road_only_scaled +\n  slope_scaled +\n  dist_sett_scaled +\n  remoteness_scaled +\n  us_scaled +\n  os_scaled +\n  (1 | id), data = DF_mod_day, family = binomial, na.action = \"na.fail\")\n\nm_sett <- glmer(pres_abs ~\n  dist_road_only_scaled +\n  slope_scaled +\n  forest_prop_scaled +\n  remoteness_scaled +\n  us_scaled +\n  os_scaled +\n  (1 | id), data = DF_mod_day, family = binomial, na.action = \"na.fail\")\n\nm_slope <- glmer(pres_abs ~\n  dist_road_only_scaled +\n  forest_prop_scaled +\n  remoteness_scaled +\n  dist_sett_scaled +\n  us_scaled +\n  os_scaled +\n  (1 | id), data = DF_mod_day, family = binomial, na.action = \"na.fail\")\n\nm_remote <- glmer(pres_abs ~\n  dist_road_only_scaled +\n  forest_prop_scaled +\n  slope_scaled +\n  dist_sett_scaled +\n  us_scaled +\n  os_scaled +\n  (1 | id), data = DF_mod_day, family = binomial, na.action = \"na.fail\")\n\nbbmle::AICtab(m_day, m_os, m_us, m_road, m_forest, m_sett, m_slope, m_remote)\n##          dAIC  df\n## m_os       0.0 8 \n## m_slope    0.3 8 \n## m_sett     1.0 8 \n## m_day      1.7 9 \n## m_remote  12.5 8 \n## m_us      81.8 8 \n## m_road    98.1 8 \n## m_forest 139.5 8\n```\n:::\n\n\n## \n\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}