{
  "hash": "b03353f01894f2531a9ff2a0ae58d744",
  "result": {
    "engine": "knitr",
    "markdown": "---\nexecute:\n  echo: true   # set to true to show musterlösung\n  output: true # set to true to show musterlösung\ncode-fold: true\ncode-summary: \"Musterlösung\"\nknitr:\n  opts_chunk: \n    collapse: true\n---\n\n\n# Daten(vor)verarbeitung\n\n## Projektaufbau RStudio-Projekte\n\nVor den eigentlichen Auswertungen müssen einige vorbereitende Arbeiten unternommen werden. Die Zeit, die man hier investiert, wird in der späteren Projektphase um ein vielfaches eingespart. Im Skript soll die Ordnerstruktur des Projekts genannt werden, damit der Arbeitsvorgang auf verschiedenen Rechnern reproduzierbar ist.\n\nArbeitet mit Projekten, da diese sehr einfach untereinander ausgetauscht und somit auch reproduziert werden können; es gibt keine absoluten Arbeitspfade sondern nur relative. Der Datenimport (und auch der Export) kann mithilfe dieser relativen Pfaden stark vereinfacht werden. Projekte helfen alles am richtigen Ort zu behalten. (mehr zur Arbeit mit Projekten: [Link](https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects))\n\n## Aufbau von R-Skripten\n\nIm Kopf des Skripts zuerst immer den Titel des Projekts sowie die Autor:innen des Skripts nennen. Hier soll auch die Herkunft der Daten ersichtlich sein und falls externe Daten verwendet werden, sollte geklärt werden, wer die Datenherrschaft hat (Rehdaten: Forschungsgruppe WILMA).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# .##################################################################################\n# Daten(vor)verarbeitung Fallstudie WPZ  ####\n# Modul Research Methods, HS24. Autor/in ####\n# .##################################################################################\n```\n:::\n\n\nBeschreibt zudem folgendes:\n\n- Ordnerstruktur; ich verwende hier den Projektordner mit den Unterordnern: \n  - Skripts\n  - Data\n  - Results\n  - Plots\n- Verwendete Daten\n\nEin Skript soll in R eigentlich immer nach dem selbem Schema aufgebaut sein.\nDieses Schema beinhaltet (nach dem bereits erwähnten Kopf des Skripts) 4 Kapitel: \n\n1. Datenimport\n2. Datenvorverarbeitung\n3. Analyse\n4. Visualisierung\n\nBereitet euer Skript also nach dieser Struktur vor. Nutzt für den Text, welcher nicht Code ist, vor dem Text das Symbol #. Wenn ihr den Text als Titel definieren wollt, der die grobe Struktur des Skripts absteckt, baut in wie in folgendem Beispiel auf:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# .###################################################################################\n# METADATA ####\n# .###################################################################################\n# Datenherkunft ####\n# ...\n\n# .###################################################################################\n# 1. DATENIMPORT ####\n# .###################################################################################\n```\n:::\n\n\n## Libraries laden\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(\"readr\")\nlibrary(\"dplyr\")\nlibrary(\"ggplot2\")\nlibrary(\"purrr\")\n```\n:::\n\n\n## Daten laden\nHerunterladen der Daten der [Feldaufnahmen](https://moodle.zhaw.ch/mod/folder/view.php?id=1361461) von Moodle (Aufgabe3_Feldaufnahmen_alle_Gruppen.zip), Einlesen, Sichtung der Datensätze und der Datentypen.\n\nVerschiedene Dinge funktionierten nicht auf Anhieb:\n\n- Daten Gruppe 1: leere Zeilen zwischen jedem Dateneintrag (R ist intelligent genug dies beim Einlesen zu erkennen)\n- Daten Gruppe 5: leere Zeilen zwischen jedem Dateneintrag (R ist intelligent genug dies beim Einlesen zu erkennen)\n- Daten Gruppe 6: \n    - Excelfile --> csv daraus machen\n    - Koordinaten fehlen, diese werden benötigt um die Daten über die Kreise eindeutig mit den LIDAR-Daten zusammenzuführen --> einfügen aus Zuteilung_Kreise_Aufnahmen_Landforst_HS24.docx \n    - Kreise als Datentyp character, müssen numeric sein\n- Daten Gruppe 7: Koordinaten fehlen, diese werden benötigt um die Daten über die Kreise eindeutig mit den LIDAR-Daten zusammenzuführen --> einfügen aus Zuteilung_Kreise_Aufnahmen_Landforst_HS24.docx \n\nVersucht wenn möglich solche Dinge jeweils direkt mit R zu lösen, dies ist vorallem bei grösseren Datensätzen extrem hilfreich, damit die Datensätze zu einem sauberen Gesamtdatensatz zusammengefügt werden können.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndf_team1 <- read_delim(\"datasets/fallstudie_n/Aufgabe3_Feldaufnahmen_alle_Gruppen/Aufgabe_2_Team1.csv\", delim = \";\") \n\ndf_team2 <- read_delim(\"datasets/fallstudie_n/Aufgabe3_Feldaufnahmen_alle_Gruppen/FelderhebungenSilhwaldKreise.csv\", delim = \",\")\n\ndf_team3 <- read_delim(\"datasets/fallstudie_n/Aufgabe3_Feldaufnahmen_alle_Gruppen/Felderhebungen Waldstruktur Team 3 pink (Gruppe 4).csv\", delim = \";\")\n\ndf_team4 <- read_delim(\"datasets/fallstudie_n/Aufgabe3_Feldaufnahmen_alle_Gruppen/Felderhebung_Gruppe 5.csv\", delim = \";\")\n\ndf_team5 <- read_delim(\"datasets/fallstudie_n/Aufgabe3_Feldaufnahmen_alle_Gruppen/TEAM 5 (violett) - Felderhebungen Waldstruktur.csv\", delim = \",\")\n\ndf_team6 <- read_delim(\"datasets/fallstudie_n/Aufgabe3_Feldaufnahmen_alle_Gruppen/Felderhebung_Team6.csv\", \n                       delim = \";\", \n                       locale = locale(encoding = \"latin1\")) %>%\n  mutate(Punkt = parse_number(Punkt)) \n\n\ndf_team7 <- read_delim(\"datasets/fallstudie_n/Aufgabe3_Feldaufnahmen_alle_Gruppen/gr7_ground_thruth_lidar.csv\", delim = \";\")\n\n\n# hier können die Probekreise mit den Angaben zur Anzahl Rehlokalisationen und der\n# LIDAR-basierten Ableitung der Waldstruktur eingelesen werden\n\ndf_lidar <- read_delim(\"datasets/fallstudie_n/Aufgabe3_LIDAR_Waldstruktur_Reh_Kreise_241011.csv\", delim = \";\")\nstr(df_lidar)\n## spc_tbl_ [305 × 7] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n##  $ Anz_reh_lokalisationen: num [1:305] 0 0 0 0 0 0 0 0 0 0 ...\n##  $ x                     : num [1:305] 684900 684900 684900 684900 684875 ...\n##  $ y                     : num [1:305] 237100 237125 237150 237175 237075 ...\n##  $ DG_us_2014            : num [1:305] 0.0903 0.2717 0.468 0.7407 0.1811 ...\n##  $ DG_os_2014            : num [1:305] 0.908 0.959 0.871 0.986 0.86 ...\n##  $ DG_us_2022            : num [1:305] 0.269 0.823 0.936 0.359 0.245 ...\n##  $ DG_os_2022            : num [1:305] 0.945 0.99 0.953 0.997 0.898 ...\n##  - attr(*, \"spec\")=\n##   .. cols(\n##   ..   Anz_reh_lokalisationen = col_double(),\n##   ..   x = col_double(),\n##   ..   y = col_double(),\n##   ..   DG_us_2014 = col_double(),\n##   ..   DG_os_2014 = col_double(),\n##   ..   DG_us_2022 = col_double(),\n##   ..   DG_os_2022 = col_double()\n##   .. )\n##  - attr(*, \"problems\")=<externalptr>\n\n# Die eingelesenen Datensätze anschauen und versuchen zu einem Gesamtdatensatz\n# verbinden. Ist der Output zufriedenstellend?\n\ndf_gesamt <- bind_rows(df_team1, df_team2, df_team3, df_team4, df_team5,df_team6,df_team7)\nstr(df_gesamt)\n## spc_tbl_ [175 × 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n##  $ Kreis (r 12.5m)               : num [1:175] 0 1 2 3 4 5 6 7 8 9 ...\n##  $ X                             : num [1:175] 684900 684875 684875 684875 684850 ...\n##  $ Y                             : num [1:175] 237175 237125 237175 237250 237225 ...\n##  $ Deckungsgrad Rubus sp. [%]    : num [1:175] 20 20 15 55 17 10 15 10 20 65 ...\n##  $ DG Strauchschicht [%] (0.5-3m): num [1:175] 50 35 50 60 90 75 75 80 15 27 ...\n##  $ DG Baumschicht [%] (ab 3m)    : num [1:175] 30 40 65 70 60 70 60 45 63 40 ...\n##  $ Punkt                         : num [1:175] NA NA NA NA NA NA NA NA NA NA ...\n##  $ Rubus sp.                     : num [1:175] NA NA NA NA NA NA NA NA NA NA ...\n##  $ Strauchschicht                : num [1:175] NA NA NA NA NA NA NA NA NA NA ...\n##  $ Baumschicht                   : num [1:175] NA NA NA NA NA NA NA NA NA NA ...\n##  $ Kreis                         : num [1:175] NA NA NA NA NA NA NA NA NA NA ...\n##  $ DG_Rubus_sp                   : num [1:175] NA NA NA NA NA NA NA NA NA NA ...\n##  $ DG_Strauchschicht             : num [1:175] NA NA NA NA NA NA NA NA NA NA ...\n##  $ DG_Baumschicht                : num [1:175] NA NA NA NA NA NA NA NA NA NA ...\n##  - attr(*, \"spec\")=\n##   .. cols(\n##   ..   `Kreis (r 12.5m)` = col_double(),\n##   ..   X = col_double(),\n##   ..   Y = col_double(),\n##   ..   `Deckungsgrad Rubus sp. [%]` = col_double(),\n##   ..   `DG Strauchschicht [%] (0.5-3m)` = col_double(),\n##   ..   `DG Baumschicht [%] (ab 3m)` = col_double()\n##   .. )\n##  - attr(*, \"problems\")=<externalptr>\n```\n:::\n\n\n## Aufgabe 1\n\n- 1.1 Einfügen zusätzliche Spalte pro Datensatz mit der Gruppenzugehörigkeit (Team1-7) \n- 1.2 Spaltenumbenennung damit die Bezeichungen in allen Datensätzen gleich sind und der Gesamtdatensatz ohne Probleme zusammengefügt werden kann\n  - → Befehle mutate und rename, mit pipes (alt: `%>%`, neu: `|>`) in einem Schritt möglich\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# .#################################################################################\n# 2. DATENVORVERARBEITUNG #####\n# .#################################################################################\n\ndf_team1 <- df_team1 |>\n  mutate(team = \"team1\") |>\n  rename(\n    KreisID = \"Kreis (r 12.5m)\",\n    DG_Rubus = \"Deckungsgrad Rubus sp. [%]\",\n    DG_Strauchschicht = \"DG Strauchschicht [%] (0.5-3m)\",\n    DG_Baumschicht = \"DG Baumschicht [%] (ab 3m)\"\n  )\n\ndf_team2 <- df_team2 |>\n  mutate(team = \"team2\") |>\n  rename(\n    KreisID = \"Kreis (r 12.5m)\",\n    DG_Rubus = \"Deckungsgrad Rubus sp. [%]\",\n    DG_Strauchschicht = \"DG Strauchschicht [%] (0.5-3m)\",\n    DG_Baumschicht = \"DG Baumschicht [%] (ab 3m)\"\n  )\n\ndf_team3 <- df_team3 |>\n  mutate(team = \"team3\") |>\n  rename(\n    KreisID = \"Kreis (r 12.5m)\",\n    DG_Rubus = \"Deckungsgrad Rubus sp. [%]\",\n    DG_Strauchschicht = \"DG Strauchschicht [%] (0.5-3m)\",\n    DG_Baumschicht = \"DG Baumschicht [%] (ab 3m)\"\n  )\n\ndf_team4 <- df_team4 |>\n  mutate(team = \"team4\") |>\n  rename(\n    KreisID = \"Kreis (r 12.5m)\",\n    DG_Rubus = \"Deckungsgrad Rubus sp. [%]\",\n    DG_Strauchschicht = \"DG Strauchschicht [%] (0.5-3m)\",\n    DG_Baumschicht = \"DG Baumschicht [%] (ab 3m)\"\n  )\n\ndf_team5 <- df_team5 |>\n  mutate(team = \"team5\") |>\n  rename(\n    KreisID = \"Kreis (r 12.5m)\",\n    DG_Rubus = \"Deckungsgrad Rubus sp. [%]\",\n    DG_Strauchschicht = \"DG Strauchschicht [%] (0.5-3m)\",\n    DG_Baumschicht = \"DG Baumschicht [%] (ab 3m)\"\n  )\n\ndf_team6 <- df_team6 |>\n  mutate(team = \"team6\") |>\n  rename(\n    KreisID = \"Punkt\",\n    DG_Rubus = \"Rubus sp.\",\n    DG_Strauchschicht = \"Strauchschicht\",\n    DG_Baumschicht = \"Baumschicht\"\n  )\n\ndf_team7 <- df_team7 |>\n  mutate(team = \"team7\") |>\n  rename(\n    KreisID = \"Kreis\",\n    DG_Rubus = \"DG_Rubus_sp\",\n    DG_Strauchschicht = \"DG_Strauchschicht\",\n    DG_Baumschicht = \"DG_Baumschicht\"\n  )\n```\n:::\n\n\nDas Learning aus den Vorverarbeitungen die ich für euch übernommen habe und aus Aufgabe 1 ist, dass beim Erfassen und Dokumentieren von Daten aus verschiedenen Quellen darauf geachtet werden sollte, dies möglichst einheitlich zu tun (Dateiformate, Spalten, Bezeichnungen, Datentypen, usw.), damit kann man sich viel Arbeit ersparen. Hilfreich ist in diesem Zusammenhang immer ein einheitliches Feldprotokoll resp. eine Vorlage für die Erfassung der Daten zu erstellen.\n\n\n## Aufgabe 2\n\nZusammenführen der Teildatensätze zu einem Datensatz\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_gesamt <- bind_rows(df_team1, df_team2, df_team3, df_team4, df_team5, df_team6, df_team7)\n```\n:::\n\n\n## Aufgabe 3\n\nVerbinden (join) des Datensatzes der Felderhebungen mit dem Datensatz der LIDAR Variablen in den Reh-Kreisen (Aufgabe3_LIDAR_Waldstruktur_Reh_Kreise_241011.csv). \n\n**Ziel: ein Datensatz mit allen Kreisen der Felderhebung, angereichert mit den Umweltvariablen Understory und Overstory aus den LIDAR-Daten (DG_us_2022, DG_os_2022) aus dem LIDAR-Waldstruktur-Datensatz.** \n--> Welche Art von join? Welche Spalten zum Verbinden (join_by()) der Datensätze\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_with_LIDAR <- left_join(df_gesamt, df_lidar, join_by(X == x, Y == y))\n```\n:::\n\n\n## Aufgabe 4\n\nScatterplot der korrespondondierenden Umweltvariablen aus den Felderhebungen gegen die Umweltvariablen aus den LiDAR-Daten (DG_xy_2022) erstellen (zusätzlich Einfärben der Gruppen und Regressionslinie darüberlegen). Korrelieren die Feldaufnahmen und die LiDAR basierte Waldstruktur?\n\nIm LiDAR Datensatz gibt es dieselben Variablen der Waldstruktur aus der LiDAR-Befliegung  2014. Ihr könnt untersuchen wie sich diese verändert haben und wie gut oder eben auch nicht sie mit euren Feldaufnahmen übereinstimmen. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# .#####################################################################################\n# 4. VISUALISERUNG #####\n# .#####################################################################################\n\nggplot(df_with_LIDAR, aes(DG_us_2022, DG_Strauchschicht, color = team)) +\n  geom_point() +\n  stat_smooth(method = \"lm\") +\n  xlim(0, 1) +\n  ylim(0, 100) +\n  geom_abline(slope = 100, intercept = 0, linetype = \"dashed\", color = \"red\")\n```\n\n::: {.cell-output-display}\n![](2_Datenverarbeitung_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n\nwrite_delim(df_with_LIDAR, \"datasets/fallstudie_n/df_with_lidar_2024.csv\", delim = \";\")\n```\n:::\n\n## (Zusatz-)Aufgabe 5\n\nHerunterladen der Felderhebungsdaten von Moodle aus den vergangenen Jahren. Zusammenführen aller Datensätze. Explorative Datenanalyse zu den Veränderungen der Erhebungen ground truth LiDAR über die Zeit und zum Zusammenhang mit den LiDAR-basierten Waldstrukturvariablen aus den zwei Befliegungszeiträumen (2014 und 2022)\n\n!Achtung! es sind nicht alle Jahre gleich viele Teams an den Erhebungen beteiligt gewesen, daher gib es nicht für alle Teams in allen Jahren Daten.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nfiles <- list.files(\"datasets/fallstudie_n/Aufgabe3_Feldaufnahmen_vergangene_Jahre\", pattern = \"*.csv\", full.names = TRUE)\n\n\ndf_ground_truth <- files %>%\n  map_df(~ read_delim(.x, delim = \";\") %>% \n           mutate(Jahr = gsub(\"df_ground_truth_|\\\\.csv$\", \"\", basename(.x))))\n\n\ndf_without_LIDAR <- df_with_LIDAR %>% dplyr::select(KreisID:team) %>% mutate(Jahr = \"2024\")\n\ndf_ground_truth <- bind_rows(df_without_LIDAR, df_ground_truth)\n\ndf_ground_truth_with_LIDAR <- left_join(df_ground_truth, df_lidar, join_by(X == x, Y == y))\n\ndf_ground_truth_with_LIDAR %>%\n  ggplot(aes(KreisID, DG_Strauchschicht, color = as.numeric(Jahr), size = as.numeric(Jahr))) +\n  facet_wrap(~team, ncol = 1) +\n  geom_point() +\n  scale_color_viridis_c(option = \"plasma\") +  \n  scale_size_continuous(range = c(1, 3)) +  \n  labs(color = \"Year\", shape = \"Year\", size = \"Year\") +  \n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](2_Datenverarbeitung_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\n\ndf_without_LIDAR <- df_without_LIDAR %>% dplyr::select(-Jahr)\n\nwrite_delim(df_without_LIDAR, \"datasets/fallstudie_n/df_ground_truth_2024.csv\", delim = \";\")\n```\n:::",
    "supporting": [
      "2_Datenverarbeitung_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}