{
  "hash": "361079a273854dff53172fd2026307c7",
  "result": {
    "markdown": "---\ndate: 2023-10-31\nlesson: Stat2\nthema: Einführung in lineare Modelle\nindex: 6\nformat:\n  html:\n    code-tools:\n      source: true\nknitr:\n    opts_chunk:\n        collapse: false\n---\n\n\n# Stat2: Lösung 2.3N\n\n- Download dieses Lösungsscript via \"\\</\\>Code\" (oben rechts)\n- [Lösungstext als Download](Statistik_Loesung_2.3N.pdf)\n\n**Übungsaufgabe (hier so ausführlich formuliert, wie dies auch in der Klausur der Fall sein wird)**\n\n- Laden Sie den Datensatz kormoran.csv mit ein Dieser enthält Tauchzeiten (hier ohne Einheit) von Kormoranen in Abhängigkeit von Jahreszeit und Unterart. Unterarten: Phalacrocorax carbo carbo (C) und Phalacrocorax carbo sinensis (S); Jahreszeiten: F = Frühling, S = Sommer, H = Herbst, W = Winter.\n- **Ihre Gesamtaufgabe ist es, aus diesen Daten ein minimal adäquates Modell zu ermitteln, das diese Abhängigkeit beschreibt.**\n- Bitte erklären und begründen Sie die einzelnen Schritte, die Sie unternehmen, um zu diesem Ergebnis zu kommen. Dazu erstellen Sie bitte ein Word-Dokument, in das Sie Schritt für Schritt den verwendeten R-Code, die dazu gehörigen Ausgaben von R, Ihre Interpretation derselben und die sich ergebenden Schlussfolgerungen für das weitere Vorgehen dokumentieren.\n- Dieser Ablauf sollte insbesondere beinhalten:\n  - Überprüfen der Datenstruktur nach dem Einlesen, welches sind die abhängige(n) und welches die unabängige(n) Variablen, welches statistische Verfahren wenden Sie an?\n  - Explorative Datenanalyse, um zu sehen, ob schon vor dem Start der Analysen Transformationen o.ä. vorgenommen werden sollten\n  - Definition eines vollen Modelles, das nach statistischen Kritierien zum minimal adäquaten Modell reduziert wird\n  - Durchführen der Modelldiagnostik, um zu entscheiden, ob das gewählte Vorgehen korrekt war oder ggf. angepasst werden muss\n  - Generieren aller Zahlen, Statistiken und Tabellen, die für eine wiss. Ergebnisdarstellung benötigt werden\n- Formulieren Sie abschliessend einen Methoden- und Ergebnisteil (ggf. incl. adäquaten Abbildungen) zu dieser Untersuchung in der Form einer wissenschaftlichen Arbeit (ausformulierte schriftliche Zusammenfassung, mit je einem Absatz von ca. 60-100 Worten, resp. 3-8 Sätzen für den Methoden- und Ergebnisteil). D. h. alle wichtigen Informationen sollten enthalten sein, unnötige Redundanz dagegen vermieden werden.\n- **Zu erstellen sind (a) Ein lauffähiges R-Skript; (b) begründeter Lösungsweg (Kombination aus R-Code, R Output und dessen Interpretation) und (c) ausformulierter Methoden- und Ergebnisteil (für eine wiss. Arbeit).**\n\n## Kommentierter Lösungsweg\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"readr\")\n\n# Working directory muss angepasst werden\nkormoran <- read_delim(\"datasets/stat1-4/kormoran.csv\", \";\", col_types = cols(\"Unterart\" = \"f\", \"Jahreszeit\" = \"f\")) \n\n# Ueberpruefen, ob Einlesen richtig funktioniert hat und welche Datenstruktur vorliegt\nstr(kormoran)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nspc_tbl_ [40 × 4] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ Obs       : num [1:40] 1 2 3 4 5 6 7 8 9 10 ...\n $ Tauchzeit : num [1:40] 9.5 11.9 13.4 13.8 15.3 15.5 15.6 16.7 16.8 18.7 ...\n $ Unterart  : Factor w/ 2 levels \"C\",\"S\": 1 1 1 1 1 1 1 1 1 1 ...\n $ Jahreszeit: Factor w/ 4 levels \"F\",\"S\",\"H\",\"W\": 1 1 1 1 1 2 2 2 2 2 ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   Obs = col_double(),\n  ..   Tauchzeit = col_double(),\n  ..   Unterart = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE),\n  ..   Jahreszeit = col_factor(levels = NULL, ordered = FALSE, include_na = FALSE)\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n:::\n\n```{.r .cell-code}\nsummary(kormoran)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      Obs          Tauchzeit     Unterart Jahreszeit\n Min.   : 1.00   Min.   : 9.50   C:20     F:10      \n 1st Qu.:10.75   1st Qu.:13.38   S:20     S:10      \n Median :20.50   Median :16.75            H:10      \n Mean   :20.50   Mean   :17.40            W:10      \n 3rd Qu.:30.25   3rd Qu.:20.77                      \n Max.   :40.00   Max.   :30.40                      \n```\n:::\n:::\n\n\nMan erkennt, dass es sich um einen Dataframe mit einer metrischen (Tauchzeit) und zwei kategorialen (Unterart, Jahreszeit) Variablen handelt.\nDie adäquate Analyse (1 metrische Abhängige vs. 2 kategoriale Unabhängige) ist damit eine zweifaktorielle ANOVA\nDie Sortierung der Jahreszeiten (default: alphabetisch) ist inhaltlich aber nicht sinnvoll und sollte angepasst werden.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Umsortieren der Faktoren, damit sie in den Boxplots eine sinnvolle Reihung haben\nkormoran$Jahreszeit <- ordered(kormoran$Jahreszeit, levels = c(\"F\", \"S\", \"H\", \"W\"))\nkormoran$Jahreszeit\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] F F F F F S S S S S H H H H H W W W W W F F F F F S S S S S H H H H H W W W\n[39] W W\nLevels: F < S < H < W\n```\n:::\n\n```{.r .cell-code}\n# Explorative Datenanalyse (zeigt uns die Gesamtverteilung)\nboxplot(kormoran$Tauchzeit)\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nDas ist noch OK für parametrische Verfahren (Box ziemlich symmetrisch um Median, Whisker etwas asymmetrisch aber nicht kritisch). Wegen der leichten Asymmetrie (Linksschiefe) könnte man eine log-Transformation ausprobieren.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(log10(kormoran$Tauchzeit))\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nDer Gesamtboxplot für log10 sieht perfekt symmetrisch aus, das spräche also für eine log10-Transformation. De facto kommt es aber nicht auf den Gesamtboxplot an, sondern auf die einzelnen.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Explorative Datenanalyse\n# (Check auf Normalverteilung der Residuen und Varianzhomogenitaet)\nboxplot(Tauchzeit ~ Jahreszeit * Unterart, data = kormoran)\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nboxplot(log10(Tauchzeit) ~ Jahreszeit * Unterart, data = kormoran)\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n\nHier sieht mal die Verteilung für die untransformierten Daten, mal für die transformierten besser aus. Da die Transformation keine klare Verbesserung bringt, bleiben wir im Folgenden bei den untransformierten Daten, da diese leichter (direkter) interpretiert werden können\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Vollständiges Modell mit Interaktion\naov.1 <- aov(Tauchzeit ~ Unterart * Jahreszeit, data = kormoran)\naov.1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\n   aov(formula = Tauchzeit ~ Unterart * Jahreszeit, data = kormoran)\n\nTerms:\n                Unterart Jahreszeit Unterart:Jahreszeit Residuals\nSum of Squares   106.929    756.170              11.009    84.992\nDeg. of Freedom        1          3                   3        32\n\nResidual standard error: 1.629724\nEstimated effects may be unbalanced\n```\n:::\n\n```{.r .cell-code}\nsummary(aov.1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    Df Sum Sq Mean Sq F value   Pr(>F)    \nUnterart             1  106.9  106.93  40.259 4.01e-07 ***\nJahreszeit           3  756.2  252.06  94.901 5.19e-16 ***\nUnterart:Jahreszeit  3   11.0    3.67   1.382    0.266    \nResiduals           32   85.0    2.66                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# p-Wert der Interaktion ist 0.266\n```\n:::\n\n\nDas volle (maximale) Modell zeigt, dass es keine signifikante Interaktion zwischen Jahreszeit und Unterart gibt. Wir können das Modell also vereinfachen, indem wir die Interaktion herausnehmen (+ statt * in der Modellspezifikation)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Modellvereinfachung\naov.2 <- aov(Tauchzeit ~ Unterart + Jahreszeit, data = kormoran)\naov.2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\n   aov(formula = Tauchzeit ~ Unterart + Jahreszeit, data = kormoran)\n\nTerms:\n                Unterart Jahreszeit Residuals\nSum of Squares   106.929    756.170    96.001\nDeg. of Freedom        1          3        35\n\nResidual standard error: 1.656166\nEstimated effects may be unbalanced\n```\n:::\n\n```{.r .cell-code}\nsummary(aov.2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Df Sum Sq Mean Sq F value   Pr(>F)    \nUnterart     1  106.9  106.93   38.98 3.69e-07 ***\nJahreszeit   3  756.2  252.06   91.89  < 2e-16 ***\nResiduals   35   96.0    2.74                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nIm so vereinfachten Modell sind alle verbleibenden Terme signifikant, wir sind also beim „minimal adäquaten Modell“ angelangt\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Anderer Weg, um zu pruefen, ob man das komplexere Modell mit Interaktion behalten soll\nanova(aov.1, aov.2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nModel 1: Tauchzeit ~ Unterart * Jahreszeit\nModel 2: Tauchzeit ~ Unterart + Jahreszeit\n  Res.Df    RSS Df Sum of Sq      F Pr(>F)\n1     32 84.992                           \n2     35 96.001 -3   -11.009 1.3817 0.2661\n```\n:::\n\n```{.r .cell-code}\n# In diesem Fall bekommen wir den gleichen p-Wert wie oben (0.266)\n\n# Modelldiagnostik\npar(mfrow = c(2, 2)) # alle vier Abbildungen in einem 2 x 2 Raster\nplot(aov.2)\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninfluence.measures(aov.2) #\n# kann man sich zusätzlich zum \"plot\" ansehen, um herauszufinden,\n# ob es evtl. sehr einflussreiche Werte mit Cook's D von 1 oder grösser gibt\n```\n:::\n\n\nLinks oben ist alles bestens, d. h. keine Hinweise auf Varianzheterogenität („Keil“) oder Nichtlinearität („Banane“)\nRechts oben ganz gut, allerdings weichen Punkte 1 und 20 deutlich von der optimalen Gerade ab -> aus diesem Grund können wir es doch noch mal mit der log10-Transformation versuchen (s.u.)\nRechts unten: kein Punkt hat einen problematischen Einfluss (die roten Linien für Cook’s D > 0.5 und > 1 sind noch nicht einmal im Bildausschnitt.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Alternative mit log10\naov.3 <- aov(log10(Tauchzeit) ~ Unterart + Jahreszeit, data = kormoran)\naov.3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\n   aov(formula = log10(Tauchzeit) ~ Unterart + Jahreszeit, data = kormoran)\n\nTerms:\n                 Unterart Jahreszeit Residuals\nSum of Squares  0.0627004  0.4958434 0.0562031\nDeg. of Freedom         1          3        35\n\nResidual standard error: 0.04007247\nEstimated effects may be unbalanced\n```\n:::\n\n```{.r .cell-code}\nsummary(aov.3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            Df Sum Sq Mean Sq F value   Pr(>F)    \nUnterart     1 0.0627 0.06270   39.05 3.64e-07 ***\nJahreszeit   3 0.4958 0.16528  102.93  < 2e-16 ***\nResiduals   35 0.0562 0.00161                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nplot(aov.3)\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-9-4.png){width=672}\n:::\n:::\n\n\nRechts oben: Punkt 20 jetzt auf der Linie, aber Punkt 1 weicht umso deutlicher ab -> keine Verbesserung -> wir bleiben bei den untransformierten Daten.\nDa wir keine Interaktion zwischen Unterart und Jahreszeit festgestellt haben, brauchen wir auch keinen Interaktionsplot (unnötig kompliziert), statt dessen können wir die Ergebnisse am besten mit zwei getrennten Plots für die beiden Faktoren darstellen. Bitte die Achsenbeschriftungen und den Tukey post-hoc-Test nicht vergessen.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1, 1)) # Zurückschalten auf Einzelplots\nlibrary(\"multcomp\")\n\nboxplot(Tauchzeit ~ Unterart, data = kormoran)\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\nletters <- cld(glht(aov.2, linfct = mcp(Jahreszeit = \"Tukey\")))\nboxplot(Tauchzeit ~ Jahreszeit, data = kormoran)\nmtext(letters$mcletters$Letters, at = 1:4)\n```\n\n::: {.cell-output-display}\n![](Statistik2_Loesung_23n_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n:::\n\n\nJetzt brauchen wir noch die Mittelwerte bzw. Effektgroessen\n\nFür den Ergebnistext brauchen wir auch noch Angaben zu den Effektgrössen. Hier sind zwei Möglichkeiten, um an sie zu gelangen.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"dplyr\")\n\nkormoran |>\n  group_by(Jahreszeit) |>\n  summarise(Tauchzeit = mean(Tauchzeit))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 2\n  Jahreszeit Tauchzeit\n  <ord>          <dbl>\n1 F               11.9\n2 S               15.1\n3 H               19.2\n4 W               23.4\n```\n:::\n\n```{.r .cell-code}\nkormoran |>\n  group_by(Unterart) |>\n  summarise(Tauchzeit = mean(Tauchzeit))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  Unterart Tauchzeit\n  <fct>        <dbl>\n1 C             19.0\n2 S             15.8\n```\n:::\n\n```{.r .cell-code}\nsummary(lm(Tauchzeit ~ Jahreszeit, data = kormoran))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Tauchzeit ~ Jahreszeit, data = kormoran)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-3.820 -1.617 -0.145  1.587  6.980 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   17.4000     0.3754  46.351  < 2e-16 ***\nJahreszeit.L   8.6804     0.7508  11.562 1.12e-13 ***\nJahreszeit.Q   0.4800     0.7508   0.639    0.527    \nJahreszeit.C  -0.1923     0.7508  -0.256    0.799    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.374 on 36 degrees of freedom\nMultiple R-squared:  0.7884,\tAdjusted R-squared:  0.7708 \nF-statistic: 44.72 on 3 and 36 DF,  p-value: 3.156e-12\n```\n:::\n\n```{.r .cell-code}\nsummary(lm(Tauchzeit ~ Unterart, data = kormoran))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Tauchzeit ~ Unterart, data = kormoran)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-9.535 -3.585 -0.335  3.760 11.365 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   19.035      1.059  17.976   <2e-16 ***\nUnterartS     -3.270      1.498  -2.184   0.0352 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 4.736 on 38 degrees of freedom\nMultiple R-squared:  0.1115,\tAdjusted R-squared:  0.08811 \nF-statistic: 4.768 on 1 and 38 DF,  p-value: 0.03523\n```\n:::\n:::\n",
    "supporting": [
      "Statistik2_Loesung_23n_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}