{
  "hash": "bf97e68f6e533cf753e5c62123ee9705",
  "result": {
    "engine": "knitr",
    "markdown": "---\nlesson: Statistik6\nknitr:\n  opts_chunk: \n    collapse: false\n---\n\n\n# Statistik 6: Demo\n\n[Demoscript herunterladen (.R)](../purl/Statistik6_Demo.R){.dld}\n\n[Demoscript herunterladen (.qmd)](../purl/Statistik6_Demo.qmd){.dld}\n\n\n\n-   Datensatz *rm_plants.csv*\n-   Datensatz *DeerEcervi.csv*\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Packete laden\nlibrary(\"pacman\")\np_load(\"tidyverse\", \"sjPlot\", \"car\", \"lme4\", \"glmmTMB\", \"performance\", \"DHARMa\")\n```\n:::\n\n\n## Repeated measurement\n\nEs handelt sich um einen Düngeversuch (Daten aus Lepš & Šmilauer 2020). 18 Pflanzenindividuen wurden zufällig einer von drei Düngevarianten zugewiesen und dabei zu vier Zeitpunkten ihre Wuchshöhe gemessen. Abhängigkeiten sind hier in zwei Aspekten vorhanden: einerseits wurde jedes Pflanzenindividuum mehrfach gemessen, andererseits hat es nur jeweils eine Düngervariante erhalten\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Daten laden\nplantf <- read_delim(\"datasets/stat/rm_plants.csv\", delim = \";\") |>\n  mutate(across(where(is.character), as.factor))\n\nstr(plantf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [72 × 4] (S3: tbl_df/tbl/data.frame)\n $ PlantHeight: num [1:72] 5 7 9 11 6 9 12 15 7 8 ...\n $ Treatment  : Factor w/ 3 levels \"Nitrogen\",\"Phosphorus\",..: 3 3 3 3 1 1 1 1 2 2 ...\n $ Time       : Factor w/ 4 levels \"T0\",\"T1\",\"T2\",..: 1 2 3 4 1 2 3 4 1 2 ...\n $ PlantID    : Factor w/ 18 levels \"P01\",\"P02\",\"P03\",..: 1 1 1 1 2 2 2 2 3 3 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(plantf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  PlantHeight          Treatment  Time       PlantID  \n Min.   : 4.000   Nitrogen  :24   T0:18   P01    : 4  \n 1st Qu.: 6.000   Phosphorus:24   T1:18   P02    : 4  \n Median : 9.000   Water     :24   T2:18   P03    : 4  \n Mean   : 9.306                   T3:18   P04    : 4  \n 3rd Qu.:11.000                           P05    : 4  \n Max.   :18.000                           P06    : 4  \n                                          (Other):48  \n```\n\n\n:::\n\n```{.r .cell-code}\ntable(plantf$Treatment, plantf$PlantID)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            \n             P01 P02 P03 P04 P05 P06 P07 P08 P09 P10 P11 P12 P13 P14 P15 P16\n  Nitrogen     0   4   0   0   4   0   0   4   0   0   4   0   0   4   0   0\n  Phosphorus   0   0   4   0   0   4   0   0   4   0   0   4   0   0   4   0\n  Water        4   0   0   4   0   0   4   0   0   4   0   0   4   0   0   4\n            \n             P17 P18\n  Nitrogen     4   0\n  Phosphorus   0   4\n  Water        0   0\n```\n\n\n:::\n\n```{.r .cell-code}\n# Mit aov\npf_eaov <- aov(PlantHeight ~ Treatment * Time  + Error(PlantID), data = plantf)\nsummary(pf_eaov)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nError: PlantID\n          Df Sum Sq Mean Sq F value   Pr(>F)    \nTreatment  2 115.36   57.68   21.68 3.76e-05 ***\nResiduals 15  39.92    2.66                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nError: Within\n               Df Sum Sq Mean Sq F value   Pr(>F)    \nTime            3  588.1  196.02  382.13  < 2e-16 ***\nTreatment:Time  6   64.9   10.81   21.07 1.37e-11 ***\nResiduals      45   23.1    0.51                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# Als lmm \npf_lmm <- glmmTMB(PlantHeight ~ Treatment * Time + (1 | PlantID), \n                 family = gaussian, \n                 REML = TRUE,\n                 data = plantf)\n\nAnova(pf_lmm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: PlantHeight\n                  Chisq Df Pr(>Chisq)    \nTreatment        43.351  2  3.859e-10 ***\nTime           1146.390  3  < 2.2e-16 ***\nTreatment:Time  126.444  6  < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(pf_lmm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian  ( identity )\nFormula:          PlantHeight ~ Treatment * Time + (1 | PlantID)\nData: plantf\n\n     AIC      BIC   logLik deviance df.resid \n   204.4    236.3    -88.2    176.4       70 \n\nRandom effects:\n\nConditional model:\n Groups   Name        Variance Std.Dev.\n PlantID  (Intercept) 0.537    0.7328  \n Residual             0.513    0.7162  \nNumber of obs: 72, groups:  PlantID, 18\n\nDispersion estimate for gaussian family (sigma^2): 0.513 \n\nConditional model:\n                           Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                  5.1667     0.4183  12.351  < 2e-16 ***\nTreatmentPhosphorus          0.6667     0.5916   1.127 0.259796    \nTreatmentWater               0.1667     0.5916   0.282 0.778160    \nTimeT1                       4.3333     0.4135  10.479  < 2e-16 ***\nTimeT2                       7.6667     0.4135  18.541  < 2e-16 ***\nTimeT3                      11.3333     0.4135  27.408  < 2e-16 ***\nTreatmentPhosphorus:TimeT1  -2.1667     0.5848  -3.705 0.000211 ***\nTreatmentWater:TimeT1       -2.8333     0.5848  -4.845 1.27e-06 ***\nTreatmentPhosphorus:TimeT2  -3.6667     0.5848  -6.270 3.61e-10 ***\nTreatmentWater:TimeT2       -4.1667     0.5848  -7.125 1.04e-12 ***\nTreatmentPhosphorus:TimeT3  -5.0000     0.5848  -8.550  < 2e-16 ***\nTreatmentWater:TimeT3       -5.8333     0.5848  -9.975  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nr2(pf_lmm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# R2 for Mixed Models\n\n  Conditional R2: 0.957\n     Marginal R2: 0.912\n```\n\n\n:::\n\n```{.r .cell-code}\n# Modellvalidierung mit DHARMa\nset.seed(123)\nsimulationOutput <- simulateResiduals(fittedModel = pf_lmm, plot = TRUE, n = 1000)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot residuals vs. covariates des models\nplotResiduals(simulationOutput, form = plantf$Time)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplotResiduals(simulationOutput, form = plantf$Treatment) \n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# Darstellung (Interaktions Plot)\nplot_model(pf_lmm, \n           type = \"pred\", pred.type = \"re\",\n           terms = c(\"Time\", \"Treatment\") ) +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-2-4.png){width=672}\n:::\n:::\n\n\n\n## Split-plot Design\n\nEs wurden zufällig fünf Untersuchungsgebiete (sites) ausgewählt, in denen jeweils der gleiche Versuchsblock implementiert wurde, bestehend aus dem Management (treatment) und der Frage, ob wilde Grossherbivoren Zugang zur Fläche hatten (plot type) (Abb. 6.1). Je ein Drittel jeder Untersuchungsfläche (zufällig zugewiesen) blieb gänzlich ungenutzt(U), wurde zu Beginn kontrolliert abgebrannt und danach sich selbst überlassen (B) oder wurde jährlich gemäht (M). Innerhalb jedes Drittels wiederum wurde (zufällig zugewiesen) die Hälfte eingezäunt (F = fenced vs. O = open), um die Beweidung durch Grossherbivoren zu verhindern.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import Data\nglex <- read_delim(\"datasets/stat/Riesch_et_al_2020_grassland.csv\", delim = \";\") |>\n  mutate(across(where(is.character), as.factor))\n\nstr(glex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [60 × 9] (S3: tbl_df/tbl/data.frame)\n $ ID_plot       : Factor w/ 60 levels \"Eul_A1_MP_14\",..: 1 2 3 4 5 6 7 8 9 10 ...\n $ year          : num [1:60] 2014 2018 2014 2018 2014 ...\n $ site_code     : Factor w/ 5 levels \"Eul\",\"Kug\",\"Nun\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ site_no       : num [1:60] 4 4 4 4 4 4 4 4 4 4 ...\n $ treatment     : Factor w/ 3 levels \"B\",\"M\",\"U\": 2 2 2 2 3 3 3 3 1 1 ...\n $ plot_type     : Factor w/ 2 levels \"F\",\"O\": 2 2 1 1 2 2 1 1 1 1 ...\n $ SR            : num [1:60] 44 48 44 47 43 29 44 24 45 37 ...\n $ inverseSimpson: num [1:60] 11.41 9.9 10.25 6.51 12.35 ...\n $ BergerParker  : num [1:60] 0.193 0.21 0.187 0.35 0.155 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nglex$year <- as.factor(glex$year)\nsummary(glex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         ID_plot     year    site_code    site_no  treatment plot_type\n Eul_A1_MP_14: 1   2014:30   Eul :12   Min.   :1   B:20      F:30     \n Eul_A1_MP_18: 1   2018:30   Kug :12   1st Qu.:2   M:20      O:30     \n Eul_A2_MK_14: 1             Nun :12   Median :3   U:20               \n Eul_A2_MK_18: 1             SomO:12   Mean   :3                      \n Eul_B1_WP_14: 1             SomW:12   3rd Qu.:4                      \n Eul_B1_WP_18: 1                       Max.   :5                      \n (Other)     :54                                                      \n       SR        inverseSimpson    BergerParker   \n Min.   :24.00   Min.   : 2.538   Min.   :0.1200  \n 1st Qu.:39.75   1st Qu.: 7.169   1st Qu.:0.1732  \n Median :44.00   Median : 9.945   Median :0.2133  \n Mean   :43.52   Mean   : 9.347   Mean   :0.2551  \n 3rd Qu.:48.00   3rd Qu.:11.555   3rd Qu.:0.2891  \n Max.   :61.00   Max.   :16.102   Max.   :0.6100  \n                                                  \n```\n\n\n:::\n\n```{.r .cell-code}\ntable(glex$site_code, glex$treatment, glex$plot_type, glex$year)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n, ,  = F,  = 2014\n\n      \n       B M U\n  Eul  1 1 1\n  Kug  1 1 1\n  Nun  1 1 1\n  SomO 1 1 1\n  SomW 1 1 1\n\n, ,  = O,  = 2014\n\n      \n       B M U\n  Eul  1 1 1\n  Kug  1 1 1\n  Nun  1 1 1\n  SomO 1 1 1\n  SomW 1 1 1\n\n, ,  = F,  = 2018\n\n      \n       B M U\n  Eul  1 1 1\n  Kug  1 1 1\n  Nun  1 1 1\n  SomO 1 1 1\n  SomW 1 1 1\n\n, ,  = O,  = 2018\n\n      \n       B M U\n  Eul  1 1 1\n  Kug  1 1 1\n  Nun  1 1 1\n  SomO 1 1 1\n  SomW 1 1 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# balanced Design\n```\n:::\n\n\n\n## LMM with random interecept\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# REML = TRUE : (Restricted maximum likelihood) v.s \n# REML = FALSE: Maximum likelihood (ML) \n# Bei REML sind die estimates genauer, aber REML sollte nicht für likelihood \n# ratio test (drop1) benutzt werden\n# Dies ist nur relevant für Gaussian mixed models (LMM) nicht für GLMMs\n\n# 2.1 Model fitten\nlmm_1 <- glmmTMB(SR ~ year * treatment * plot_type + \n               (1| site_code/treatment/plot_type), \n               family = gaussian, \n               REML = FALSE,\n               data = glex)\n\nAnova(lmm_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: SR\n                           Chisq Df Pr(>Chisq)    \nyear                     58.6751  1  1.860e-14 ***\ntreatment                 5.3910  2   0.067509 .  \nplot_type                 3.1397  1   0.076406 .  \nyear:treatment           27.5733  2  1.029e-06 ***\nyear:plot_type            8.0419  1   0.004571 ** \ntreatment:plot_type       3.6181  2   0.163812    \nyear:treatment:plot_type  0.9435  2   0.623917    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# Model optimierung\ndrop1(lmm_1, test = \"Chi\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSingle term deletions\n\nModel:\nSR ~ year * treatment * plot_type + (1 | site_code/treatment/plot_type)\n                         Df    AIC     LRT Pr(>Chi)\n<none>                      385.27                 \nyear:treatment:plot_type  2 382.20 0.92894   0.6285\n```\n\n\n:::\n\n```{.r .cell-code}\nlmm_2 <- update(lmm_1,~. -year:treatment:plot_type)\ndrop1(lmm_2, test = \"Chi\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSingle term deletions\n\nModel:\nSR ~ year + treatment + plot_type + (1 | site_code/treatment/plot_type) + \n    year:treatment + year:plot_type + treatment:plot_type\n                    Df    AIC     LRT  Pr(>Chi)    \n<none>                 382.20                      \nyear:treatment       2 398.84 20.6412 3.295e-05 ***\nyear:plot_type       1 387.26  7.0678  0.007848 ** \ntreatment:plot_type  2 381.44  3.2413  0.197775    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nlmm_3 <- update(lmm_2,~. -treatment:plot_type)\ndrop1(lmm_3, test = \"Chi\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSingle term deletions\n\nModel:\nSR ~ year + treatment + plot_type + (1 | site_code/treatment/plot_type) + \n    year:treatment + year:plot_type\n               Df    AIC     LRT  Pr(>Chi)    \n<none>            381.44                      \nyear:treatment  2 397.16 19.7253 5.208e-05 ***\nyear:plot_type  1 386.37  6.9307  0.008473 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# Refit with REML\nlmm_4 <- update(lmm_3, REML = TRUE)\n\n# Resultat\nAnova(lmm_4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: SR\n                 Chisq Df Pr(>Chisq)    \nyear           49.3013  1  2.195e-12 ***\ntreatment       4.3128  2   0.115741    \nplot_type       2.3609  1   0.124407    \nyear:treatment 23.1682  2  9.313e-06 ***\nyear:plot_type  6.7571  1   0.009338 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(lmm_4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian  ( identity )\nFormula:          \nSR ~ year + treatment + plot_type + (1 | site_code/treatment/plot_type) +  \n    year:treatment + year:plot_type\nData: glex\n\n     AIC      BIC   logLik deviance df.resid \n   358.2    383.3   -167.1    334.2       56 \n\nRandom effects:\n\nConditional model:\n Groups                        Name        Variance Std.Dev.\n plot_type:treatment:site_code (Intercept)  2.1332  1.4606  \n treatment:site_code           (Intercept)  8.0931  2.8448  \n site_code                     (Intercept)  0.8542  0.9242  \n Residual                                  18.6692  4.3208  \nNumber of obs: 60, groups:  \nplot_type:treatment:site_code, 30; treatment:site_code, 15; site_code, 5\n\nDispersion estimate for gaussian family (sigma^2): 18.7 \n\nConditional model:\n                    Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           45.900      2.136  21.487  < 2e-16 ***\nyear2018              -8.200      2.231  -3.675 0.000238 ***\ntreatmentM             2.300      2.720   0.846 0.397761    \ntreatmentU             3.800      2.720   1.397 0.162377    \nplot_typeO            -1.000      1.665  -0.600 0.548210    \nyear2018:treatmentM    2.400      2.733   0.878 0.379808    \nyear2018:treatmentU  -10.000      2.733  -3.659 0.000253 ***\nyear2018:plot_typeO    5.800      2.231   2.599 0.009338 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nr2(lmm_4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# R2 for Mixed Models\n\n  Conditional R2: 0.688\n     Marginal R2: 0.502\n```\n\n\n:::\n\n```{.r .cell-code}\n# Modellvalidierung \nset.seed(123)\nsimulationOutput <- simulateResiduals(fittedModel = lmm_4, plot = TRUE, n = 1000)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot residuals vs. covariates des models\nplotResiduals(simulationOutput, form = glex$year)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplotResiduals(simulationOutput, form = glex$treatment)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n\n```{.r .cell-code}\nplotResiduals(simulationOutput, form = glex$plot_type)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-4-4.png){width=672}\n:::\n\n```{.r .cell-code}\n# Darstellung\nplot_model(lmm_4, \n           type = \"pred\", pred.type = \"re\", \n           terms = c(\"year\", \"treatment\", \"plot_type\") ) +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-4-5.png){width=672}\n:::\n:::\n\n\n## Random slope & random intercept\n\nIm folgenden Beispiel wurde bei 18 Versuchspersonen die Wirkung von zunehmenden Schlafentzug auf die Reaktionszeit (in ms) gemessen. Bei jeder Versuchsperson wurde der Effekt an den Tagen 2–9 des Versuchs je einmal gemessen (Tage 0 und 1 sind die Trainingsphase und bleiben daher unberücksichtigt).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Daten laden\ndata(sleepstudy)\n?sleepstudy\n\n# Daten ohne Trainingsphase\nsleepstudy_2 <- subset(sleepstudy, Days>=2)\nstr(sleepstudy_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t144 obs. of  3 variables:\n $ Reaction: num  251 321 357 415 382 ...\n $ Days    : num  2 3 4 5 6 7 8 9 2 3 ...\n $ Subject : Factor w/ 18 levels \"308\",\"309\",\"310\",..: 1 1 1 1 1 1 1 1 2 2 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(sleepstudy_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Reaction          Days         Subject  \n Min.   :203.0   Min.   :2.00   308    : 8  \n 1st Qu.:265.2   1st Qu.:3.75   309    : 8  \n Median :303.2   Median :5.50   310    : 8  \n Mean   :308.0   Mean   :5.50   330    : 8  \n 3rd Qu.:347.7   3rd Qu.:7.25   331    : 8  \n Max.   :466.4   Max.   :9.00   332    : 8  \n                                (Other):96  \n```\n\n\n:::\n\n```{.r .cell-code}\ntable(sleepstudy_2$Subject)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n308 309 310 330 331 332 333 334 335 337 349 350 351 352 369 370 371 372 \n  8   8   8   8   8   8   8   8   8   8   8   8   8   8   8   8   8   8 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Visualisierung\nggplot(sleepstudy_2, aes(y = Reaction, x = Days)) +\n  geom_point() +\n  xlab(\"Average reaction time (ms)\") +\n  ylab(\"Number of days of sleep deprivation\") +\n  geom_smooth(method = \"lm\", formula = 'y ~ x', se = F, fullrange = T) +\n  theme_classic() +\n  facet_wrap(~Subject)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nWie man in der Visualisierung sehen kann, unterscheiden sich nicht nur die Intercepts (Reaktionszeit ohne Schlafmangel), sondern der Schlafmangel scheint sich auch unterschiedlich stark auf die Reaktionszeit der Probanden auszuwirken. In diesem Fall ist es daher sinnvoll, nicht nur einen Random Intercept, sondern auch einen Random Slope zu fitten.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit model\nlmm_1 <- glmmTMB(Reaction ~ Days + (Days | Subject),\n                 family = gaussian,\n                 REML = TRUE,\n                 data = sleepstudy_2)\n\nsummary(lmm_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian  ( identity )\nFormula:          Reaction ~ Days + (Days | Subject)\nData: sleepstudy_2\n\n     AIC      BIC   logLik deviance df.resid \n  1416.1   1433.9   -702.0   1404.1      140 \n\nRandom effects:\n\nConditional model:\n Groups   Name        Variance Std.Dev. Corr  \n Subject  (Intercept) 992.63   31.506         \n          Days         45.78    6.766   -0.25 \n Residual             651.60   25.526         \nNumber of obs: 144, groups:  Subject, 18\n\nDispersion estimate for gaussian family (sigma^2):  652 \n\nConditional model:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  245.097      9.260  26.469  < 2e-16 ***\nDays          11.435      1.845   6.197 5.75e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nr2(lmm_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# R2 for Mixed Models\n\n  Conditional R2: 0.806\n     Marginal R2: 0.206\n```\n\n\n:::\n\n```{.r .cell-code}\n# Modellvalidierung\nset.seed(123)\nsimulationOutput <- simulateResiduals(fittedModel = lmm_1, plot = TRUE, n = 1000)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplotResiduals(simulationOutput, form = sleepstudy_2$Days)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Visualisierung\nplot_model(lmm_1, \n           type = \"pred\", pred.type = \"re\",\n           show.data = TRUE) +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n:::\n\n\n## GLMM\n\nBefall von Rothirschen (Cervus elaphus) in spanischen Farmen mit dem Parasiten Elaphostrongylus cervi. Modelliert wird Vorkommen/Nichtvorkommen von L1-Larven\n130 dieser Nematode in Abhängigkeit von Körperlänge und Geschlecht der Hirsche. Erhoben wurden die Daten auf 24 Farmen.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Daten laden und für GLMM aufbereiten\nDeerEcervi <- read_delim(\"datasets/stat/DeerEcervi.csv\", delim = \";\") |>\n  mutate(across(where(is.character), as.factor))\n\n# Daten anschauen\nstr(DeerEcervi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [826 × 4] (S3: tbl_df/tbl/data.frame)\n $ Farm  : Factor w/ 24 levels \"AL\",\"AU\",\"BA\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ Sex   : Factor w/ 2 levels \"female\",\"male\": 2 1 1 1 1 1 1 1 1 1 ...\n $ Length: num [1:826] 164 216 208 206 204 200 199 197 196 196 ...\n $ Ecervi: num [1:826] 0 0 0 1 0 0 1 1 1 0 ...\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(DeerEcervi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  Farm  Sex    Length Ecervi\n  <fct> <fct>   <dbl>  <dbl>\n1 AL    male      164      0\n2 AL    female    216      0\n3 AL    female    208      0\n4 AL    female    206      1\n5 AL    female    204      0\n6 AL    female    200      0\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(DeerEcervi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Farm         Sex          Length          Ecervi      \n MO     :209   female:448   Min.   : 75.0   Min.   :0.0000  \n CB     : 85   male  :378   1st Qu.:151.0   1st Qu.:0.0000  \n QM     : 60                Median :163.0   Median :1.0000  \n BA     : 50                Mean   :161.8   Mean   :0.6465  \n PN     : 37                3rd Qu.:174.9   3rd Qu.:1.0000  \n MB     : 34                Max.   :216.0   Max.   :1.0000  \n (Other):351                                                \n```\n\n\n:::\n\n```{.r .cell-code}\ntable(DeerEcervi$Farm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  AL   AU   BA   BE   CB  CRC   HB   LN  MAN   MB   MO   NC   NV   PN   QM   RF \n  15   32   50   13   85    1   17   33   27   34  209   27   20   37   60   20 \n  RN   RO  SAU   SE   TI   TN VISO   VY \n  23   30    3   26   19   25   13    7 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Kontinuierliche variable Hischlänge standardisieren\nStd <- function(x) { (x - mean(x)) / sd(x)}\nDeerEcervi$Lengt_std <-  Std(DeerEcervi$Length)\n# oder\nDeerEcervi$Length_std <- as.vector( scale(DeerEcervi$Length, center = TRUE))\n\n# Model fitten\nglmm_1 <- glmmTMB(Ecervi ~ scale(Length) * Sex + (1 | Farm), \n                  family = binomial, \n                  data = DeerEcervi)\n\ncar::Anova(glmm_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: Ecervi\n                    Chisq Df Pr(>Chisq)    \nscale(Length)     70.7552  1  < 2.2e-16 ***\nSex                4.4962  1   0.033969 *  \nscale(Length):Sex  9.8309  1   0.001716 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\ndrop1(glmm_1, test = \"Chi\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSingle term deletions\n\nModel:\nEcervi ~ scale(Length) * Sex + (1 | Farm)\n                  Df    AIC    LRT Pr(>Chi)   \n<none>               832.56                   \nscale(Length):Sex  1 840.78 10.225 0.001385 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(glmm_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: binomial  ( logit )\nFormula:          Ecervi ~ scale(Length) * Sex + (1 | Farm)\nData: DeerEcervi\n\n     AIC      BIC   logLik deviance df.resid \n   832.6    856.1   -411.3    822.6      821 \n\nRandom effects:\n\nConditional model:\n Groups Name        Variance Std.Dev.\n Farm   (Intercept) 2.393    1.547   \nNumber of obs: 826, groups:  Farm, 24\n\nConditional model:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)             0.9397     0.3579   2.625  0.00865 ** \nscale(Length)           0.7638     0.1363   5.604 2.09e-08 ***\nSexmale                 0.6245     0.2242   2.785  0.00535 ** \nscale(Length):Sexmale   0.7027     0.2241   3.135  0.00172 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nr2(glmm_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# R2 for Mixed Models\n\n  Conditional R2: 0.504\n     Marginal R2: 0.143\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Modellvalidierung\n\n# Test overdisepersion\ncheck_overdispersion(glmm_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Overdispersion test\n\n dispersion ratio = 1.064\n          p-value =   0.6\n```\n\n\n:::\n\n```{.r .cell-code}\nset.seed(123)\nsimulationOutput <- simulateResiduals(fittedModel = glmm_1, plot = TRUE, n = 1000)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot the scaled quantile residuals versus fitted values.\nplotResiduals(simulationOutput, form = DeerEcervi$Sex)\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplotResiduals(simulationOutput, form = DeerEcervi$Length_std) \n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-9-3.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualisierung\nplot_model(glmm_1, \n           type = \"pred\", pred.type = \"re\", \n           terms = c(\"Length[all]\", \"Sex\"),  \n           show.data = TRUE) +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Statistik6_Demo_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Statistik6_Demo_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}